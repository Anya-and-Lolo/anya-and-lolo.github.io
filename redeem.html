<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Redeem</title>
</head>
<body>
  <h1>Redeem</h1>

  <button id="connect">Connect Patreon</button>
  <p id="status">Loadingâ€¦</p>

  <h2>Store</h2>
  <button onclick="redeem('item_1')">Redeem Item 1</button>

  <script>
    const API = "https://YOUR_WORKER_DOMAIN";

    document.getElementById("connect").onclick = () => {
      location.href = API + "/auth/patreon/start";
    };

    async function loadMe() {
      const r = await fetch(API + "/me", { credentials: "include" });
      const me = await r.json();
      if (!me.loggedIn) {
        document.getElementById("status").textContent = "Not connected yet.";
        return;
      }
      document.getElementById("status").textContent = `Credits: ${me.credits} (Patreon status: ${me.patreon_status})`;
    }

    async function redeem(itemId) {
      const r = await fetch(API + "/redeem", {
        method: "POST",
        headers: { "content-type": "application/json" },
        credentials: "include",
        body: JSON.stringify({ itemId })
      });
      const out = await r.json();
      alert(JSON.stringify(out, null, 2));
      await loadMe();
    }

    loadMe();
  </script>
</body>
</html>
